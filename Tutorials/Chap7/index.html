<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>7&#31456; : &#38899;&#12434;&#40180;&#12425;&#12375;&#12390;&#12415;&#12424;&#12358; | Altseed2 </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="7&#31456; : &#38899;&#12434;&#40180;&#12425;&#12375;&#12390;&#12415;&#12424;&#12358; | Altseed2 ">
    <meta name="generator" content="docfx 2.56.1.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <link rel="stylesheet" href="../../styles/reference.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" src="../../Logo.png" alt="" style="height:100%;margin-right:15px;">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                
                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../../Tutorials/index.html" title="&#12481;&#12517;&#12540;&#12488;&#12522;&#12450;&#12523;">&#12481;&#12517;&#12540;&#12488;&#12522;&#12450;&#12523;</a>
                      </li>
                      <li>
                          <a href="../../Manual/index.html" title="&#27231;&#33021;&#35299;&#35500;">&#27231;&#33021;&#35299;&#35500;</a>
                      </li>
                      <li>
                          <a href="../../References/Altseed2.html" title="&#12522;&#12501;&#12449;&#12524;&#12531;&#12473;">&#12522;&#12501;&#12449;&#12524;&#12531;&#12473;</a>
                      </li>
                      <li>
                          <a href="../../First/index.html" title="&#21021;&#20195;Altseed&#12399;&#12467;&#12481;&#12521;">&#21021;&#20195;Altseed&#12399;&#12467;&#12481;&#12521;</a>
                      </li>
                </ul>    </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">
                  
                  <ul class="nav level1">
                    <li class="">
                      <a href="../index.html" title="&#12481;&#12517;&#12540;&#12488;&#12522;&#12450;&#12523;" class="">&#12481;&#12517;&#12540;&#12488;&#12522;&#12450;&#12523;</a>
                    </li>
                    <li class="">
                      <a href="../Chap0/index.html" title="0&#31456; : Altseed&#12434;&#21021;&#12417;&#12424;&#12358;" class="">0&#31456; : Altseed&#12434;&#21021;&#12417;&#12424;&#12358;</a>
                    </li>
                    <li class="">
                      <a href="../Chap1/index.html" title="1&#31456; : &#12454;&#12451;&#12531;&#12489;&#12454;&#12434;&#34920;&#31034;&#12375;&#12390;&#12415;&#12424;&#12358;" class="">1&#31456; : &#12454;&#12451;&#12531;&#12489;&#12454;&#12434;&#34920;&#31034;&#12375;&#12390;&#12415;&#12424;&#12358;</a>
                    </li>
                    <li class="">
                      <a href="../Chap2/index.html" title="2&#31456; : &#12461;&#12515;&#12521;&#12463;&#12479;&#12540;&#12434;&#25551;&#30011;&#12375;&#12390;&#12415;&#12424;&#12358;" class="">2&#31456; : &#12461;&#12515;&#12521;&#12463;&#12479;&#12540;&#12434;&#25551;&#30011;&#12375;&#12390;&#12415;&#12424;&#12358;</a>
                    </li>
                    <li class="">
                      <a href="../Chap3/index.html" title="3&#31456; : &#12461;&#12515;&#12521;&#12463;&#12479;&#12540;&#12395;&#24382;&#12434;&#25731;&#12383;&#12379;&#12390;&#12415;&#12424;&#12358;" class="">3&#31456; : &#12461;&#12515;&#12521;&#12463;&#12479;&#12540;&#12395;&#24382;&#12434;&#25731;&#12383;&#12379;&#12390;&#12415;&#12424;&#12358;</a>
                    </li>
                    <li class="">
                      <a href="../Chap4/index.html" title="4&#31456; : &#12463;&#12521;&#12473;&#12434;&#33258;&#20998;&#12391;&#35373;&#35336;&#12375;&#12390;&#12415;&#12424;&#12358;" class="">4&#31456; : &#12463;&#12521;&#12473;&#12434;&#33258;&#20998;&#12391;&#35373;&#35336;&#12375;&#12390;&#12415;&#12424;&#12358;</a>
                    </li>
                    <li class="">
                      <a href="../Chap5/index.html" title="5&#31456; : &#25973;&#12539;&#25973;&#12398;&#12471;&#12519;&#12483;&#12488;&#12434;&#34920;&#31034;&#12375;&#12390;&#12415;&#12424;&#12358;" class="">5&#31456; : &#25973;&#12539;&#25973;&#12398;&#12471;&#12519;&#12483;&#12488;&#12434;&#34920;&#31034;&#12375;&#12390;&#12415;&#12424;&#12358;</a>
                    </li>
                    <li class="">
                      <a href="../Chap6/index.html" title="6&#31456; : &#24403;&#12383;&#12426;&#21028;&#23450;&#12398;&#27231;&#33021;&#12434;&#20351;&#12387;&#12390;&#12415;&#12424;&#12358;" class="">6&#31456; : &#24403;&#12383;&#12426;&#21028;&#23450;&#12398;&#27231;&#33021;&#12434;&#20351;&#12387;&#12390;&#12415;&#12424;&#12358;</a>
                    </li>
                    <li class="active">
                      <a href="../Chap7/index.html" title="7&#31456; : &#38899;&#12434;&#40180;&#12425;&#12375;&#12390;&#12415;&#12424;&#12358;" class="active">7&#31456; : &#38899;&#12434;&#40180;&#12425;&#12375;&#12390;&#12415;&#12424;&#12358;</a>
                    </li>
                    <li class="">
                      <a href="../Chap8/index.html" title="8&#31456; : &#24471;&#28857;&#12434;&#34920;&#31034;&#12375;&#12390;&#12415;&#12424;&#12358;" class="">8&#31456; : &#24471;&#28857;&#12434;&#34920;&#31034;&#12375;&#12390;&#12415;&#12424;&#12358;</a>
                    </li>
                    <li class="">
                      <a href="../Chap9/index.html" title="9&#31456; : &#12479;&#12452;&#12488;&#12523;&#12539;&#12466;&#12540;&#12512;&#12458;&#12540;&#12496;&#12540;&#30011;&#38754;&#12434;&#20316;&#12387;&#12390;&#12415;&#12424;&#12358;" class="">9&#31456; : &#12479;&#12452;&#12488;&#12523;&#12539;&#12466;&#12540;&#12512;&#12458;&#12540;&#12496;&#12540;&#30011;&#38754;&#12434;&#20316;&#12387;&#12390;&#12415;&#12424;&#12358;</a>
                    </li>
                    <li class="">
                      <a href="../Chap10/index.html" title="10&#31456; : &#12356;&#12374;&#12289;&#20844;&#38283;&#28310;&#20633;" class="">10&#31456; : &#12356;&#12374;&#12289;&#20844;&#38283;&#28310;&#20633;</a>
                    </li>
                  </ul>        </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="7章--音を鳴らしてみよう">7章 : 音を鳴らしてみよう</h1>

<p>前章では、当たり判定を実装しました。<br>
この章では、ゲームに不可欠な音を追加します。<br>
ゲームには、オブジェクトの動きに合わせたサウンドエフェクト(SE)やゲームの雰囲気を作り出すBGMが必要です。<br>
以下では、SEやBGMを再生する処理を実装します。</p>
<h2 id="seを鳴らす">SEを鳴らす</h2>
<p>今回は、以下のSEを再生します。</p>
<ul>
<li>プレイヤーのショット音</li>
<li>プレイヤーの死亡時サウンド</li>
<li>敵共通の死亡時サウンド</li>
<li>まっすぐな弾を発射する敵のショット音</li>
<li>放射ショットの敵のショット音</li>
</ul>
<h3 id="プレイヤーのショット音を追加">プレイヤーのショット音を追加</h3>
<p><code>Player.cs</code>に以下のソースコードを追加します。</p>
<pre><code class="lang-diff" name="Main">using Altseed2;

namespace Tutorial
{
    // プレイヤーのクラス
    public class Player : CollidableObject
    {
+       // ショット時の効果音
+       private Sound shotSound;

        // コンストラクタ
        public Player(MainNode mainNode, Vector2F position) : base(mainNode, position)
        {
            // 衝突判定を行うように設定
            doSurvey = true;

            // テクスチャを読み込む
            Texture = Texture2D.LoadStrict(&quot;Resources/Player.png&quot;);

            // 中心座標を設定
            CenterPosition = ContentSize / 2;

            // コライダの半径を設定
            collider.Radius = Texture.Size.Y / 2;

+           // ショット音を読み込む
+           shotSound = Sound.LoadStrict(&quot;Resources/shot1.wav&quot;, true);
        }

        // 衝突時に実行
        protected override void OnCollision(CollidableObject obj)
        {
            // 衝突対象が敵か敵の弾だったら
            if (obj is Enemy || obj is EnemyBullet)
            {
                // 自身を親から削除
                Parent.RemoveChildNode(this);
            }
        }

        // フレーム毎に実行
        protected override void OnUpdate()
        {
            // 移動を実行
            Move();

            // ショットを実行
            Shot();

            // CollidableObjectのOnupdate呼び出し
            base.OnUpdate();
        }

        // 移動を行う
        private void Move()
        {
            // 現在のX座標を取得する
            var x = Position.X;
            // 現在のY座標を取得する
            var y = Position.Y;

            // ↑キーでY座標を減少
            if (Engine.Keyboard.GetKeyState(Key.Up) == ButtonState.Hold)
            {
                y -= 2.5f;
            }

            // ↓キーでY座標を増加
            if (Engine.Keyboard.GetKeyState(Key.Down) == ButtonState.Hold)
            {
                y += 2.5f;
            }

            // →キーでX座標を増加
            if (Engine.Keyboard.GetKeyState(Key.Right) == ButtonState.Hold)
            {
                x += 2.5f;
            }

            // ←キーでX座標を減少
            if (Engine.Keyboard.GetKeyState(Key.Left) == ButtonState.Hold)
            {
                x -= 2.5f;
            }

            // テクスチャのサイズの半分を取得する
            var halfSize = Texture.Size / 2;

            // X座標が画面外に行かないように調整
            x = MathHelper.Clamp(x, Engine.WindowSize.X - halfSize.X, halfSize.X);
            // Y座標が画面外に行かないように調整
            y = MathHelper.Clamp(y, Engine.WindowSize.Y - halfSize.Y, halfSize.Y);

            // 調整された座標を設定
            Position = new Vector2F(x, y);
        }

        // ショット
        private void Shot()
        {
            // Zキーでショットを放つ
            if (Engine.Keyboard.GetKeyState(Key.Z) == ButtonState.Push)
            {
                Parent.AddChildNode(new PlayerBullet(mainNode, Position));

+               // ショット音を鳴らす
+               Engine.Sound.Play(shotSound);
            }
        }
    }
}
</code></pre>
<pre><code class="lang-C#">// ショット時の効果音
private Sound shotSound;
</code></pre>
<p>Altseed2では、音源データを<code>Sound</code>クラスインスタンスに格納します。<br>
また、ファイルから音源データを読み込む場合は、以下のように<code>Sound.LoadStrict</code>メソッドを用います。</p>
<pre><code class="lang-C#">// ショット音を読み込む
shotSound = Sound.LoadStrict(&quot;Resources/shot1.wav&quot;, true);
</code></pre>
<p>第一引数には、音源データファイルへのパスします。<br>
そして、第二引数には、音源データを事前に解凍するか否かを指定します。<br>
一般的に、短い音をたくさん鳴らすようなSEの場合は、事前に解凍します。<br>
一方、BGMのような長い音源に対しては、事前に解凍せず、逐次解凍するようにします。</p>
<p>そして、読み込んだ音源データを再生するには、以下のように<code>Engine.Sound.Play</code>メソッドを呼び出す必要があります。</p>
<pre><code class="lang-C#">// ショット音を鳴らす
Engine.Sound.Play(shotSound);
</code></pre>
<p>引数として、上で作成した<code>Sound</code>クラスインスタンスを渡します。</p>
<p>この段階でビルドし、実行するとZキーでショットを放った瞬間に音が鳴ると思います。</p>
<h3 id="プレイヤーの死亡時サウンドを追加">プレイヤーの死亡時サウンドを追加</h3>
<p>ショット音と同様に<code>Player.cs</code>に以下のソースコードを追加します。</p>
<pre><code class="lang-diff" name="Main">using Altseed2;

namespace Tutorial
{
    // プレイヤーのクラス
    public class Player : CollidableObject
    {
        // ショット時の効果音
        private Sound shotSound;

        // コンストラクタ
        public Player(MainNode mainNode, Vector2F position) : base(mainNode, position)
        {
            // 衝突判定を行うように設定
            doSurvey = true;

            // テクスチャを読み込む
            Texture = Texture2D.LoadStrict(&quot;Resources/Player.png&quot;);

            // 中心座標を設定
            CenterPosition = ContentSize / 2;

            // コライダの半径を設定
            collider.Radius = Texture.Size.Y / 2;

            // ショット音を読み込む
            shotSound = Sound.LoadStrict(&quot;Resources/shot1.wav&quot;, true);
        }

        // 衝突時に実行
        protected override void OnCollision(CollidableObject obj)
        {
            // 衝突対象が敵か敵の弾だったら
            if (obj is Enemy || obj is EnemyBullet)
            {
+               // 死亡音を読み込む
+               var deathSound = Sound.LoadStrict(&quot;Resources/Explosion.wav&quot;, true);
+
+               // 死亡音を再生
+               Engine.Sound.Play(deathSound);
+
                // 自身を親から削除
                Parent.RemoveChildNode(this);
            }
        }

        // フレーム毎に実行
        protected override void OnUpdate()
        {
            // 移動を実行
            Move();

            // ショットを実行
            Shot();

            // CollidableObjectのOnupdate呼び出し
            base.OnUpdate();
        }

        // 移動を行う
        private void Move()
        {
            // 現在のX座標を取得する
            var x = Position.X;
            // 現在のY座標を取得する
            var y = Position.Y;

            // ↑キーでY座標を減少
            if (Engine.Keyboard.GetKeyState(Key.Up) == ButtonState.Hold)
            {
                y -= 2.5f;
            }

            // ↓キーでY座標を増加
            if (Engine.Keyboard.GetKeyState(Key.Down) == ButtonState.Hold)
            {
                y += 2.5f;
            }

            // →キーでX座標を増加
            if (Engine.Keyboard.GetKeyState(Key.Right) == ButtonState.Hold)
            {
                x += 2.5f;
            }

            // ←キーでX座標を減少
            if (Engine.Keyboard.GetKeyState(Key.Left) == ButtonState.Hold)
            {
                x -= 2.5f;
            }

            // テクスチャのサイズの半分を取得する
            var halfSize = Texture.Size / 2;

            // X座標が画面外に行かないように調整
            x = MathHelper.Clamp(x, Engine.WindowSize.X - halfSize.X, halfSize.X);
            // Y座標が画面外に行かないように調整
            y = MathHelper.Clamp(y, Engine.WindowSize.Y - halfSize.Y, halfSize.Y);

            // 調整された座標を設定
            Position = new Vector2F(x, y);
        }

        // ショット
        private void Shot()
        {
            // Zキーでショットを放つ
            if (Engine.Keyboard.GetKeyState(Key.Z) == ButtonState.Push)
            {
                Parent.AddChildNode(new PlayerBullet(mainNode, Position));

                // ショット音を鳴らす
                Engine.Sound.Play(shotSound);
            }
        }
    }
}
</code></pre><h3 id="敵共通の死亡時サウンドを追加">敵共通の死亡時サウンドを追加</h3>
<p>すべての敵共通で再生するため、<code>Enemy.cs</code>に以下のソースコードを追加します。</p>
<pre><code class="lang-diff" name="Main">using Altseed2;

namespace Tutorial
{
    // 敵の基礎となるクラス
    public class Enemy : CollidableObject
    {
        // 倒された時に加算されるスコアの値
        protected int score;

        // プレイヤーへの参照
        protected Player player;

        // コンストラクタ
        public Enemy(Player player, Vector2F position) : base(player.mainNode, position)
        {
            // 衝突判定を行うように設定
            doSurvey = true;

            // プレイヤーへの参照を設定
            this.player = player;
        }

        // 衝突時に実行
        protected override void OnCollision(CollidableObject obj)
        {
            // 衝突対象が自機弾だったら
            if (obj is PlayerBullet)
            {
                // スコアを加算
                mainNode.score += score;

                // 死亡時エフェクトを再生
                Parent.AddChildNode(new DeathEffect(Position));

                // 自身を削除
                Parent.RemoveChildNode(this);

+               // 死亡時サウンドを読み込み
+               var deathSound = Sound.LoadStrict(&quot;Resources/Explosion.wav&quot;, true);
+
+               // 死亡時サウンドを再生
+               Engine.Sound.Play(deathSound);
            }
        }

        // フレーム毎に実行
        protected override void OnUpdate()
        {
            // CollidableObjectのOnUpdateを実行
            base.OnUpdate();

            // 画面外に出たら自身を削除
            RemoveMyselfIfOutOfWindow();
        }
    }
}
</code></pre><h3 id="まっすぐな弾を発射する敵のショット音を追加">まっすぐな弾を発射する敵のショット音を追加</h3>
<p><code>StraightShotEnemy.cs</code>に以下のソースコードを追加します。</p>
<pre><code class="lang-diff" name="Main">using Altseed2;
using System;

namespace Tutorial
{
    // まっすぐな弾を発射する敵
    public class StraightShotEnemy : Enemy
    {
        // カウンタ
        private int count = 0;

+       // ショット時の効果音
+       private Sound shotSound;

        // コンストラクタ
        public StraightShotEnemy(Player player, Vector2F position) : base(player, position)
        {
            // テクスチャを読み込む
            Texture = Texture2D.LoadStrict(&quot;Resources/UFO.png&quot;);

            // 中心座標を設定
            CenterPosition = ContentSize / 2;

            // 半径を設定
            collider.Radius = Texture.Size.X / 2;

            // 倒された時に加算されるスコアを設定
            score = 20;

+           // ショット時の効果音を読み込む
+           shotSound = Sound.LoadStrict(&quot;Resources/shot2.wav&quot;, true);
        }

        // フレーム毎に実行
        protected override void OnUpdate()
        {
            // カウントが150の倍数で実行
            if (count % 150 == 0)
            {
                // プレイヤーに対するベクトルの単位ベクトルを取得
                var velocity = (player.Position - Position).Normal;
                // ベクトルの長さを調整(弾速になる)
                velocity *= 5;

                // 弾を追加
                Shot(velocity);
            }

            // 座標を設定
            Position -= new Vector2F(MathF.Sin(MathHelper.DegreeToRadian(count)) * 3.0f, 0);

            // EnemyのOnUpdateを実行
            base.OnUpdate();

            // カウントを進める
            count++;
        }

        // 弾を撃つ
        private void Shot(Vector2F velocity)
        {
            // 敵弾を画面に追加
            Parent.AddChildNode(new EnemyBullet(mainNode, Position, velocity));

+           // ショット音を再生
+           Engine.Sound.Play(shotSound);
        }
    }
}
</code></pre><h3 id="放射ショットの敵のショット音を追加">放射ショットの敵のショット音を追加</h3>
<p><code>RadialShotEnemy.cs</code>に以下のソースコードを追加します。</p>
<pre><code class="lang-diff" name="Main">using Altseed2;

namespace Tutorial
{
    // 放射ショットの敵
    public class RadialShotEnemy : Enemy
    {
        // カウンタ変数
        private int count = 0;

        // 撃ち出すショットの個数
        private int shotAmount;

+       // ショット時の効果音
+       private Sound shotSound;

        // フレーム毎の速度
        private Vector2F velocity;

        // コンストラクタ
        public RadialShotEnemy(Player player, Vector2F position, int shotAmount) : base(player, position)
        {
            // 撃ち出すショットの個数を設定
            this.shotAmount = shotAmount;

            // テクスチャを読み込む
            Texture = Texture2D.LoadStrict(&quot;Resources/UFO.png&quot;);

            // 中心座標を設定
            CenterPosition = ContentSize / 2;

            // 半径を設定
            collider.Radius = Texture.Size.X / 2;

            // スコアを設定
            score = 30;

+           // ショット時の効果音を読み込む
+           shotSound = Sound.LoadStrict(&quot;Resources/shot2.wav&quot;, true);
        }

        // フレーム毎に実行
        protected override void OnUpdate()
        {
            // カウントが250の倍数だったら
            if (count % 250 == 0)
            {
                // 計算用のローカル変数
                var half = shotAmount / 2;

                for (int i = 0; i &lt; shotAmount; i++)
                {
                    // 現時点の座標からプレイヤーに向かうベクトルの単位ベクトルを取得する
                    var vector = (player.Position - Position).Normal;

                    // ベクトルを速度分掛ける
                    vector *= 7.0f;

                    // ベクトルを傾ける
                    vector.Degree += 30 * (i - half);

                    // ショットを放つ
                    Shot(vector);
                }
            }

            // カウント÷100の余りが0～49だったら
            if (count % 100 &lt; 50)
            {
                // カウント÷100の余りが0だったら
                if (count % 100 == 0)
                {
                    // 進むベクトルを設定
                    velocity = (player.Position - Position).Normal * 3.0f;
                }

                // 速度分ベクトルを設定
                Position += velocity;
            }

            // EnemyクラスのOnUpdateを呼び出す
            base.OnUpdate();

            // カウントを進める
            count++;
        }

        // 弾を撃つ
        private void Shot(Vector2F velocity)
        {
            // 敵弾を画面に追加
            Parent.AddChildNode(new EnemyBullet(mainNode, Position, velocity));

+           // ショット音を再生
+           Engine.Sound.Play(shotSound);
        }
    }
}
</code></pre>
<p>以上を追加し、ビルドするとSEが適切なタイミングで再生されると思います。</p>
<h2 id="bgmを鳴らす">BGMを鳴らす</h2>
<p>次は、BGMを再生する処理を追加しましょう。</p>
<p>メインステージのBGMであるため、<code>MainNode.cs</code>に以下のソースコードを追加します。</p>
<pre><code class="lang-diff" name="Main">using Altseed2;
using System.Collections.Generic;

namespace Tutorial
{
    // メインステージのクラス
    public class MainNode : Node
    {
        // カウンタ
        private int count = 0;

        // 敵を格納するキュー
        private Queue&lt;Enemy&gt; enemies = new Queue&lt;Enemy&gt;();

        // キャラクターを表示するノード
        private Node characterNode = new Node();
        
        // プレイヤーの参照
        private Player player;

        // エンジンに追加された時に実行
        protected override void OnAdded()
        {
            // キャラクターノードを追加
            AddChildNode(characterNode);

            // UIを表示するノード
            var uiNode = new Node();

            // UIノードを追加
            AddChildNode(uiNode);

            // 背景に使用するテクスチャ
            var backTexture = new SpriteNode();
            // 背景のテクスチャを読み込む
            backTexture.Texture = Texture2D.LoadStrict(&quot;Resources/Background.png&quot;);
            // 表示位置を奥に設定
            backTexture.ZOrder = -100;

            // 背景テクスチャを追加
            AddChildNode(backTexture);

            // プレイヤーを設定
            player = new Player(this, new Vector2F(100, 360));

            // キャラクターノードにプレイヤーを追加
            characterNode.AddChildNode(player);

            // ウェーブを初期化する
            InitWave();

+           // BGMを初期化する
+           InitBGM();
        }

        // エンジンから削除されたときに実行
        protected override void OnRemoved()
        {
            // 衝突判定を全てリセット
            CollidableObject.objects.Clear();
        }

+       // BGMを初期化
+       private void InitBGM()
+       {
+           // BGMを読み込む
+           var bgm = Sound.LoadStrict(&quot;Resources/BGM.wav&quot;, false);
+
+           // BGMのプレイ開始
+           Engine.Sound.Play(bgm);
+       }

        // ウェーブの初期化
        private void InitWave()
        {
            // enemies.Enqueue～でウェーブに敵を追加
            // 追加した順番に敵が出現する


            enemies.Enqueue(new ChaseEnemy(player, new Vector2F(700, 160), 2.0f));

            enemies.Enqueue(new StraightShotEnemy(player, new Vector2F(600, 620)));

            enemies.Enqueue(new Meteor(player, new Vector2F(910, 400), new Vector2F(-4.0f, 0.0f)));

            enemies.Enqueue(new RadialShotEnemy(player, new Vector2F(400, 160), 3));
        }

        // フレーム毎に実行
        protected override void OnUpdate()
        {
            // ステージの更新
            UpdateStage();

            // カウントを進める
            count++;
        }

        // 敵召還関連
        private void UpdateStage()
        {
            // カウントが100の倍数だったら
            if (count % 100 == 0)
            {
                // 敵が残っていたら画面に追加
                if (enemies.Count &gt; 0)
                {
                    characterNode.AddChildNode(enemies.Dequeue());
                }
            }
        }
    }
}
</code></pre>
<p>BGMに関する初期化をするメソッド<code>InitBGM</code>を実装し、
メインステージが始まった時点で再生するため、<code>OnAdded</code>で呼び出します。</p>
<p>BGMを再生する場合も、基本的はSEと変わらず、<code>Sound</code>クラスインスタンスを用います。<br>
しかし、このままではうまくいきません。<br>
今回、BGMを再生するために、以下の処理が必要となります。</p>
<ul>
<li>ループ処理</li>
<li>再生している音の制御(一時停止、終了)</li>
</ul>
<h3 id="ループ処理">ループ処理</h3>
<p><code>InitBGM</code>メソッドに以下の処理を追加しましょう。</p>
<pre><code class="lang-diff" name="Main">using Altseed2;
using System.Collections.Generic;

namespace Tutorial
{
    // メインステージのクラス
    public class MainNode : Node
    {
        // カウンタ
        private int count = 0;

        // 敵を格納するキュー
        private Queue&lt;Enemy&gt; enemies = new Queue&lt;Enemy&gt;();

        // キャラクターを表示するノード
        private Node characterNode = new Node();
        
        // プレイヤーの参照
        private Player player;

        // エンジンに追加された時に実行
        protected override void OnAdded()
        {
            // キャラクターノードを追加
            AddChildNode(characterNode);

            // UIを表示するノード
            var uiNode = new Node();

            // UIノードを追加
            AddChildNode(uiNode);

            // 背景に使用するテクスチャ
            var backTexture = new SpriteNode();
            // 背景のテクスチャを読み込む
            backTexture.Texture = Texture2D.LoadStrict(&quot;Resources/Background.png&quot;);
            // 表示位置を奥に設定
            backTexture.ZOrder = -100;

            // 背景テクスチャを追加
            AddChildNode(backTexture);

            // プレイヤーを設定
            player = new Player(this, new Vector2F(100, 360));

            // キャラクターノードにプレイヤーを追加
            characterNode.AddChildNode(player);

            // ウェーブを初期化する
            InitWave();

            // BGMを初期化する
            InitBGM();
        }

        // エンジンから削除されたときに実行
        protected override void OnRemoved()
        {
            // 衝突判定を全てリセット
            CollidableObject.objects.Clear();
        }

        // BGMを初期化
        private void InitBGM()
        {
            // BGMを読み込む
            var bgm = Sound.LoadStrict(&quot;Resources/BGM.wav&quot;, false);

+           // BGMをループするように設定
+           bgm.IsLoopingMode = true;
+
+           // ループ開始位置を設定
+           bgm.LoopStartingPoint = 11.33f;
+
+           // ループ終了位置を設定
+           bgm.LoopEndPoint = 33.93f;

            // BGMのプレイ開始
            Engine.Sound.Play(bgm);
        }

        // ウェーブの初期化
        private void InitWave()
        {
            // enemies.Enqueue～でウェーブに敵を追加
            // 追加した順番に敵が出現する


            enemies.Enqueue(new ChaseEnemy(player, new Vector2F(700, 160), 2.0f));

            enemies.Enqueue(new StraightShotEnemy(player, new Vector2F(600, 620)));

            enemies.Enqueue(new Meteor(player, new Vector2F(910, 400), new Vector2F(-4.0f, 0.0f)));

            enemies.Enqueue(new RadialShotEnemy(player, new Vector2F(400, 160), 3));
        }

        // フレーム毎に実行
        protected override void OnUpdate()
        {
            // ステージの更新
            UpdateStage();

            // カウントを進める
            count++;
        }

        // 敵召還関連
        private void UpdateStage()
        {
            // カウントが100の倍数だったら
            if (count % 100 == 0)
            {
                // 敵が残っていたら画面に追加
                if (enemies.Count &gt; 0)
                {
                    characterNode.AddChildNode(enemies.Dequeue());
                }
            }
        }
    }
}
</code></pre>
<p>BGMをループさせるには、<code>Sound</code>クラスインスタンスの<code>IsLoopingMode</code>プロパティを<code>true</code>にします。<br>
そして、音源の任意の区間をループさせる場合、</p>
<ul>
<li><code>Sound</code>クラスインスタンスの<code>LoopStartingPoint</code>プロパティで区間の始点</li>
<li><code>Sound</code>クラスインスタンスの<code>LoopEndPoint</code>プロパティで区間の終点</li>
</ul>
<p>を指定する必要があります。</p>
<h3 id="再生している音の制御一時停止終了">再生している音の制御(一時停止、終了)</h3>
<p><code>MainNode.cs</code>に以下のソースコードを変更します。</p>
<pre><code class="lang-diff" name="Main">using Altseed2;
using System.Collections.Generic;

namespace Tutorial
{
    // メインステージのクラス
    public class MainNode : Node
    {
+       // BGMのID
+       private int? bgmID = null;
+
        // カウンタ
        private int count = 0;

        // 敵を格納するキュー
        private Queue&lt;Enemy&gt; enemies = new Queue&lt;Enemy&gt;();

        // キャラクターを表示するノード
        private Node characterNode = new Node();
        
        // プレイヤーの参照
        private Player player;

        // エンジンに追加された時に実行
        protected override void OnAdded()
        {
            // キャラクターノードを追加
            AddChildNode(characterNode);

            // UIを表示するノード
            var uiNode = new Node();

            // UIノードを追加
            AddChildNode(uiNode);

            // 背景に使用するテクスチャ
            var backTexture = new SpriteNode();
            // 背景のテクスチャを読み込む
            backTexture.Texture = Texture2D.LoadStrict(&quot;Resources/Background.png&quot;);
            // 表示位置を奥に設定
            backTexture.ZOrder = -100;

            // 背景テクスチャを追加
            AddChildNode(backTexture);

            // プレイヤーを設定
            player = new Player(this, new Vector2F(100, 360));

            // キャラクターノードにプレイヤーを追加
            characterNode.AddChildNode(player);

            // ウェーブを初期化する
            InitWave();

            // BGMを初期化する
            InitBGM();
        }

        // エンジンから削除されたときに実行
        protected override void OnRemoved()
        {
            // 衝突判定を全てリセット
            CollidableObject.objects.Clear();
        }

        // BGMを初期化
        private void InitBGM()
        {
            // BGMを読み込む
            var bgm = Sound.LoadStrict(&quot;Resources/BGM.wav&quot;, false);

            // BGMをループするように設定
            bgm.IsLoopingMode = true;

            // ループ開始位置を設定
            bgm.LoopStartingPoint = 11.33f;

            // ループ終了位置を設定
            bgm.LoopEndPoint = 33.93f;

            // BGMのプレイ開始
+           bgmID = Engine.Sound.Play(bgm);
-           Engine.Sound.Play(bgm);
        }

        // ウェーブの初期化
        private void InitWave()
        {
            // enemies.Enqueue～でウェーブに敵を追加
            // 追加した順番に敵が出現する


            enemies.Enqueue(new ChaseEnemy(player, new Vector2F(700, 160), 2.0f));

            enemies.Enqueue(new StraightShotEnemy(player, new Vector2F(600, 620)));

            enemies.Enqueue(new Meteor(player, new Vector2F(910, 400), new Vector2F(-4.0f, 0.0f)));

            enemies.Enqueue(new RadialShotEnemy(player, new Vector2F(400, 160), 3));
        }

        // フレーム毎に実行
        protected override void OnUpdate()
        {
            // ステージの更新
            UpdateStage();

            // カウントを進める
            count++;
        }

        // 敵召還関連
        private void UpdateStage()
        {
            // カウントが100の倍数だったら
            if (count % 100 == 0)
            {
                // 敵が残っていたら画面に追加
                if (enemies.Count &gt; 0)
                {
                    characterNode.AddChildNode(enemies.Dequeue());
                }
            }
        }
    }
}
</code></pre>
<p>再生している音は、<code>Engine.Sound.Play</code>メソッドの戻り値である<code>int</code>型のIDによって、制御できます。<br>
今回は、BGMはずっと再生させておくため、制御はしませんが、
今後、BGMを制御する場合に備えて、<code>MainNode</code>クラスの<code>bgmID</code>フィールドに格納しておきましょう。</p>
<p>以上を反映させて、ビルドを行うとBGMが再生されると思います。</p>
<h2 id="まとめ">まとめ</h2>
<p>本章では、ゲームに音を加えることによって、よりゲームらしくなったかと思います。<br>
みなさんのゲームでも、どんどん効果音をつけていってください。</p>
<p>次の章では、ゲーム性を高める上で重要な得点を表示させていきましょう。</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Copyright &copy; 2020 Altseed .
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
