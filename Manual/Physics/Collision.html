<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>&#34909;&#31361;&#21028;&#23450; | Altseed2 </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="&#34909;&#31361;&#21028;&#23450; | Altseed2 ">
    <meta name="generator" content="docfx 2.56.1.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <link rel="stylesheet" href="../../styles/reference.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" src="../../Logo.png" alt="" style="height:100%;margin-right:15px;">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                
                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../../Tutorials/index.html" title="&#12481;&#12517;&#12540;&#12488;&#12522;&#12450;&#12523;">&#12481;&#12517;&#12540;&#12488;&#12522;&#12450;&#12523;</a>
                      </li>
                      <li>
                          <a href="../../Manual/index.html" title="&#27231;&#33021;&#35299;&#35500;">&#27231;&#33021;&#35299;&#35500;</a>
                      </li>
                      <li>
                          <a href="../../References/Altseed2.html" title="&#12522;&#12501;&#12449;&#12524;&#12531;&#12473;">&#12522;&#12501;&#12449;&#12524;&#12531;&#12473;</a>
                      </li>
                      <li>
                          <a href="../../First/index.html" title="&#21021;&#20195;Altseed&#12399;&#12467;&#12481;&#12521;">&#21021;&#20195;Altseed&#12399;&#12467;&#12481;&#12521;</a>
                      </li>
                </ul>    </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">
                  
                  <ul class="nav level1">
                    <li class="">
                      <a href="../index.html" title="&#12522;&#12501;&#12449;&#12524;&#12531;&#12473;" class="">&#12522;&#12501;&#12449;&#12524;&#12531;&#12473;</a>
                    </li>
                    <li class="">
                      <a href="../Engine/Engine.html" title="&#12456;&#12531;&#12472;&#12531;" class="">&#12456;&#12531;&#12472;&#12531;</a>
                    </li>
                    <li class="">
                      <a href="../Node.html" title="&#12494;&#12540;&#12489;" class="">&#12494;&#12540;&#12489;</a>
                    </li>
                    <li class="">
                      <a href="../Graphics/Sprite.html" title="&#30011;&#20687;" class="">&#30011;&#20687;</a>
                    </li>
                    <li class="">
                      <a href="../Graphics/Material.html" title="&#12510;&#12486;&#12522;&#12450;&#12523;" class="">&#12510;&#12486;&#12522;&#12450;&#12523;</a>
                    </li>
                    <li class="">
                      <a href="../Graphics/Camera.html" title="&#12459;&#12513;&#12521;" class="">&#12459;&#12513;&#12521;</a>
                    </li>
                    <li class="">
                      <a href="../Graphics/PostEffect.html" title="&#12509;&#12473;&#12488;&#12456;&#12501;&#12455;&#12463;&#12488;" class="">&#12509;&#12473;&#12488;&#12456;&#12501;&#12455;&#12463;&#12488;</a>
                    </li>
                    <li class="">
                      <a href="../Sound/Sound.html" title="&#12469;&#12454;&#12531;&#12489;" class="">&#12469;&#12454;&#12531;&#12489;</a>
                    </li>
                    <li class="">
                      <a href="../Log/Log.html" title="&#12525;&#12464;" class="">&#12525;&#12464;</a>
                    </li>
                    <li class="">
                      <a href="../File/file.html" title="&#12501;&#12449;&#12452;&#12523;" class="">&#12501;&#12449;&#12452;&#12523;</a>
                    </li>
                    <li class="">
                      <a href="../File/Package.html" title="&#12501;&#12449;&#12452;&#12523;&#12497;&#12483;&#12465;&#12540;&#12472;" class="">&#12501;&#12449;&#12452;&#12523;&#12497;&#12483;&#12465;&#12540;&#12472;</a>
                    </li>
                    <li class="">
                      <a href="../Input/Joystick.html" title="&#12472;&#12519;&#12452;&#12473;&#12486;&#12451;&#12483;&#12463;" class="">&#12472;&#12519;&#12452;&#12473;&#12486;&#12451;&#12483;&#12463;</a>
                    </li>
                    <li class="">
                      <a href="../Input/Keyboard.html" title="&#12461;&#12540;&#12508;&#12540;&#12489;" class="">&#12461;&#12540;&#12508;&#12540;&#12489;</a>
                    </li>
                    <li class="">
                      <a href="../Input/Mouse.html" title="&#12510;&#12454;&#12473;" class="">&#12510;&#12454;&#12473;</a>
                    </li>
                    <li class="">
                      <a href="../Input/Cursor.html" title="&#12459;&#12540;&#12477;&#12523;" class="">&#12459;&#12540;&#12477;&#12523;</a>
                    </li>
                    <li class="">
                      <a href="../Serialization/Serialization.html" title="&#12471;&#12522;&#12450;&#12521;&#12452;&#12474;" class="">&#12471;&#12522;&#12450;&#12521;&#12452;&#12474;</a>
                    </li>
                    <li class="active">
                      <a href="../Physics/Collision.html" title="&#34909;&#31361;&#21028;&#23450;" class="active">&#34909;&#31361;&#21028;&#23450;</a>
                    </li>
                    <li class="">
                      <a href="../ShapeNode/ShapeNode.html" title="&#22259;&#24418;&#12494;&#12540;&#12489;" class="">&#22259;&#24418;&#12494;&#12540;&#12489;</a>
                    </li>
                    <li class="">
                      <a href="../Transition/Transition.html" title="&#12488;&#12521;&#12531;&#12472;&#12471;&#12519;&#12531;" class="">&#12488;&#12521;&#12531;&#12472;&#12471;&#12519;&#12531;</a>
                    </li>
                  </ul>        </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="衝突判定">衝突判定</h1>

<p>Altseed2では物理演算を用いて，2Dの衝突判定を行う機構が備わっています。</p>
<h2 id="colliderクラス"><a class="xref" href="../../References/Altseed2.Collider.html">Collider</a>クラス</h2>
<p><a class="xref" href="../../References/Altseed2.Collider.html">Collider</a>クラスは自身のメンバの情報をもとに他<a class="xref" href="../../References/Altseed2.Collider.html">Collider</a>のインスタンスとの衝突の有無を判定します。<br>
<a class="xref" href="../../References/Altseed2.Collider.html">Collider</a>と衝突判定の種類は以下の通りです。</p>
<table>
<thead>
<tr>
<th style="text-align: center;"><a class="xref" href="../../References/Altseed2.Collider.html">Collider</a></th>
<th style="text-align: center;">衝突判定のタイプ</th>
<th style="text-align: center;">使用するメンバ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><a class="xref" href="../../References/Altseed2.CircleCollider.html">CircleCollider</a></td>
<td style="text-align: center;">円形</td>
<td style="text-align: center;"><a class="xref" href="../../References/Altseed2.Collider.html#Altseed2_Collider_Position">中心</a>，<a class="xref" href="../../References/Altseed2.CircleCollider.html#Altseed2_CircleCollider_Radius">半径</a></td>
</tr>
<tr>
<td style="text-align: center;"><a class="xref" href="../../References/Altseed2.PolygonCollider.html">PolygonCollider</a></td>
<td style="text-align: center;">多角形</td>
<td style="text-align: center;"><a class="xref" href="../../References/Altseed2.PolygonCollider.html#Altseed2_PolygonCollider_Vertexes">各頂点の座標</a></td>
</tr>
<tr>
<td style="text-align: center;"><a class="xref" href="../../References/Altseed2.RectangleCollider.html">RectangleCollider</a></td>
<td style="text-align: center;">短形</td>
<td style="text-align: center;"><a class="xref" href="../../References/Altseed2.Collider.html#Altseed2_Collider_Position">左上の座標</a>，<a class="xref" href="../../References/Altseed2.RectangleCollider.html#Altseed2_RectangleCollider_Size">サイズ(縦・横)</a></td>
</tr>
</tbody>
</table>
<p><a class="xref" href="../../References/Altseed2.Collider.html">Collider</a>との衝突判定は<a class="xref" href="../../References/Altseed2.Collider.html#Altseed2_Collider_GetIsCollidedWith_Altseed2_Collider_">GetIsCollidedWith(Collider)</a>メソッドを使用します。<br>
指定したコライダと衝突していたらtrue，衝突していなかったらfalseを返します。</p>
<h2 id="collidernodeクラスとcollisionmanagernodeクラス"><a class="xref" href="../../References/Altseed2.ColliderNode.html">ColliderNode</a>クラスと<a class="xref" href="../../References/Altseed2.CollisionManagerNode.html">CollisionManagerNode</a>クラス</h2>
<p>この2つのクラスによって，コライダの衝突判定を自動で行う事が出来ます。</p>
<h3 id="collidernodeクラス"><a class="xref" href="../../References/Altseed2.ColliderNode.html">ColliderNode</a>クラス</h3>
<p>このクラスは<a class="xref" href="../../References/Altseed2.Collider.html">Collider</a>クラスを内部に持っています。<br>
また，この派生クラスに<a class="xref" href="../../References/Altseed2.CircleColliderNode.html">CircleColliderNode</a>，<a class="xref" href="../../References/Altseed2.PolygonColliderNode.html">PolygonColliderNode</a>，
<a class="xref" href="../../References/Altseed2.RectangleColliderNode.html">RectangleColliderNode</a>クラスがあり，それぞれ<a class="xref" href="../../References/Altseed2.CircleCollider.html">CircleCollider</a>，
<a class="xref" href="../../References/Altseed2.PolygonCollider.html">PolygonCollider</a>，
<a class="xref" href="../../References/Altseed2.RectangleCollider.html">RectangleCollider</a>クラスのインスタンスを内部に持っています。<br>
これらのクラスのプロパティを通して，内部コライダのメンバの操作を行う事が出来ます。</p>
<div class="IMPORTANT">
<h5>Important</h5>
<p>このクラスは，衝突判定を行いたいノード(シューティングゲームで言う自機や弾となるノード)の<strong>子ノードとして</strong>使用される必要があります。</p>
</div>
<h3 id="collisionmanagernodeクラス"><a class="xref" href="../../References/Altseed2.CollisionManagerNode.html">CollisionManagerNode</a>クラス</h3>
<p>このクラスでは<a class="xref" href="../../References/Altseed2.ColliderNode.html">ColliderNode</a>クラスのインスタンスが自動的に登録され，<a class="xref" href="../../References/Altseed2.Collider.html#Altseed2_Collider_GetIsCollidedWith_Altseed2_Collider_">GetIsCollidedWith(Collider)</a>メソッドを自動的に実行します。</p>
<div class="TIP">
<h5>Tip</h5>
<p><a class="xref" href="../../References/Altseed2.Collider.html#Altseed2_Collider_GetIsCollidedWith_Altseed2_Collider_">GetIsCollidedWith(Collider)</a>メソッドによる衝突判定は，同じ<a class="xref" href="../../References/Altseed2.ColliderNode.html">ColliderNode</a>の組み合わせに対して1フレームにつき1度しか行われません。</p>
</div>
<div class="IMPORTANT">
<h5>Important</h5>
<p>このクラスは衝突判定を行いたいノードの<strong>親ノードの子として</strong>使用される必要があります。<br>
また，1つのノードに対して，<a class="xref" href="../../References/Altseed2.CollisionManagerNode.html">CollisionManagerNode</a>クラスのインスタンスは1つしか子として持つ事が出来ません。(登録しようとした場合は例外がスローされます。)</p>
</div>
<h3 id="実装の形式">実装の形式</h3>
<p><a class="xref" href="../../References/Altseed2.ColliderNode.html">ColliderNode</a>クラスと<a class="xref" href="../../References/Altseed2.CollisionManagerNode.html">CollisionManagerNode</a>クラスはそれぞれ以下の図のような関係でなければなりません。</p>
<div class="CAUTION">
<h5>Caution</h5>
<p><a class="xref" href="../../References/Altseed2.ColliderNode.html">ColliderNode</a>の自動登録には，シーンとなるノードに対して，<strong><a class="xref" href="../../References/Altseed2.CollisionManagerNode.html">CollisionManagerNode</a>が子ノードであり，かつ<a class="xref" href="../../References/Altseed2.ColliderNode.html">ColliderNode</a>が孫ノードである</strong>事が重要です。<br>
それ以外の場合における<a class="xref" href="../../References/Altseed2.ColliderNode.html">ColliderNode</a>の自動的な追加/削除は発生しません。</p>
</div>
<p><img src="Image/Structure.png" alt="Structure"></p>
<div class="NOTE">
<h5>Note</h5>
<p>衝突判定を行うノードが<a class="xref" href="../../References/Altseed2.ICollisionEventReceiver.html">ICollisionEventReceiver</a>インターフェイスを実装している場合，</p>
<ul>
<li>衝突の開始</li>
<li>衝突の継続</li>
<li>衝突の終了</li>
</ul>
<p>においてそれぞれ対応したメソッドが呼び出されます。</p>
</div>
<p>以上の点を踏まえた実装は以下のサンプルコードの通りです。</p>
<pre><code class="lang-csharp" name="Main">using Altseed2;

using System;

namespace Sample
{
    class Collision
    {
        static void Main(string[] args)
        {
            // Altseed2 を初期化します。
            Engine.Initialize(&quot;Collision&quot;, 640, 480);

            // 衝突判定が行われるノードの親ノードを作成します。
            var scene = new Node();

            // コライダを自動処理するノードをシーンに登録します。
            scene.AddChildNode(new CollisionManagerNode());

            // 衝突判定を持つスプライトノードを生成します。
            var node1 = new CollidableSprite()
            {
                Position = new Vector2F(0, 100)
            };

            // 衝突時のイベントを実行する衝突判定を持つスプライトノードを生成します。
            var node2 = new EventRaisedCollidableSprite()
            {
                Position = new Vector2F(300, 100)
            };

            // エンジンにノードを追加します。
            scene.AddChildNode(node1);
            scene.AddChildNode(node2);
            Engine.AddNode(scene);

            // メインループ。
            // Altseed のウインドウが閉じられると終了します。
            while (Engine.DoEvents())
            {
                // 右側に移動させる
                node1.Position += new Vector2F(5, 0);

                // Altseed を更新します。
                Engine.Update();
            }

            // Altseed の終了処理をします。
            Engine.Terminate();
        }
    }

    // 衝突判定が行われるノードのクラス
    class CollidableSprite : SpriteNode
    {
        // 円形コライダを持つノード
        private readonly CircleColliderNode colliderNode = new CircleColliderNode();

        // コンストラクタ
        public CollidableSprite()
        {
            // テクスチャを読み込みます。
            Texture = Texture2D.Load(@&quot;TestData/IO/AltseedPink256.png&quot;);

            // 半径を設定します。
            colliderNode.Radius = Texture.Size.X / 2;

            // 中心を設定します。
            CenterPosition = Texture.Size / 2;

            // コライダを登録します。
            AddChildNode(colliderNode);
        }
    }

    // 衝突時の内容を実装できるクラス
    class EventRaisedCollidableSprite : CollidableSprite, ICollisionEventReceiver
    {
        // 衝突が開始された時に実行されます。
        void ICollisionEventReceiver.OnCollisionEnter(CollisionInfo info)
        {
            Color = new Color(255, 50, 50);
        }

        // 衝突が継続している時に実行されます。
        void ICollisionEventReceiver.OnCollisionStay(CollisionInfo info)
        {
            Angle++;
        }

        // 衝突が解除された時に実行されます。
        void ICollisionEventReceiver.OnCollisionExit(CollisionInfo info)
        {
            Color = new Color(255, 255, 255);
        }
    }
}
</code></pre><h4 id="結果">結果</h4>
<p>衝突を開始したときに色が赤くなり，以降衝突している間回転します。<br>
衝突終了時には色が戻ります。</p>
<h2 id="衝突範囲の描画">衝突範囲の描画</h2>
<p><code>ColliderVisualizeNodeFactory.Create(ColliderNode)</code>を使用することで，衝突領域を描画できるノードを取得できます。</p>
<div class="IMPORTANT">
<h5>Important</h5>
<p>得られたノードを，<code>Node.AddChildNode(Node)</code>で登録しなければ衝突判定の視覚化は行われません。
生成元の<a class="xref" href="../../References/Altseed2.ColliderNode.html">ColliderNode</a>を<a class="xref" href="../../References/Altseed2.CollisionManagerNode.html">CollisionManagerNode</a>の子にすることで，描画範囲を衝突範囲に同期することが出来ます。</p>
</div>
<div class="CAUTION">
<h5>Caution</h5>
<p>衝突範囲の描画の同期は，元となる<a class="xref" href="../../References/Altseed2.ColliderNode.html">ColliderNode</a>が<a class="xref" href="../../References/Altseed2.CollisionManagerNode.html">CollisionManagerNode</a>の管理下にある必要があります。</p>
</div>
<p>使い方は以下のサンプルコードを参考にしてください。</p>
<pre><code class="lang-csharp" name="Main">using Altseed2;

namespace Sample
{
    class ColliderVisualization
    {
        static void Main(string[] args)
        {
            // Altseed2 を初期化します。
            Engine.Initialize(&quot;Collision&quot;, 640, 480);

            // 衝突判定が行われるノードの親ノードを作成します。
            var scene = new Node();

            // コライダを自動処理するノードをシーンに登録します。
            scene.AddChildNode(new CollisionManagerNode());


            // 衝突判定を持つSpriteNodeを生成します。
            var texture = Texture2D.Load(@&quot;TestData/IO/AltseedPink256.png&quot;);
            var sprite = new SpriteNode()
            {
                Position = new Vector2F(200f, 200f),
                Scale = new Vector2F(0.5f, 0.5f),
                Texture = texture,
                CenterPosition = texture.Size / 2,
            };

            // 円形コライダノードを生成します。
            var collider = new CircleColliderNode()
            {
                Radius = texture.Size.X / 2,
            };

            // colliderの衝突判定を視覚化できるノードを生成します。
            var visualizer = ColliderVisualizeNodeFactory.Create(collider);

            // エンジンにノードを追加します。
            scene.AddChildNode(sprite);
            sprite.AddChildNode(collider);
            collider.AddChildNode(visualizer);
            Engine.AddNode(scene);

            // メインループ。
            // Altseed のウインドウが閉じられると終了します。
            while (Engine.DoEvents())
            {
                // Altseed を更新します。
                Engine.Update();
            }

            // Altseed の終了処理をします。
            Engine.Terminate();
        }
    }
}
</code></pre>
<p>このコードを実行すると以下のように円形の当たり判定が赤色で示されます。</p>
<p><img src="Image/Visualization.png" alt="Visualization"></p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Copyright &copy; 2020 Altseed .
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
